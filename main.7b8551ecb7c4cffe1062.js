(()=>{"use strict";class e{constructor(e,t,s,n,r,i){this._name=e.name,this._link=e.link,this._templateSelector=t,this._openImagePopup=s,this._cardId=e._id,this._ownerId=e.owner._id,this._likes=e.likes,this._userId=i,this._handleItemDelete=n,this._handleLikeClick=r,this._isLike=!1}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._deleteButton.addEventListener("click",(()=>{this._handleItemDelete(this,this._cardId)})),this._likeButton.addEventListener("click",(()=>{this._handleLikeClick(this,this._cardId)})),this._cardImage.addEventListener("click",(()=>{this._openImagePopup(this._name,this._link)}))}get isLike(){return this._isLike}setLikes(e){this._likes=e,this._likesCounter.textContent=this._likes.length,this._isLike=!this._isLike,this._likeButton.classList.toggle("card__like-button_active")}removeCard(){this._newCard.remove(),this._newCcard=null}generateCard(){return this._newCard=this._getTemplate(),this._cardImage=this._newCard.querySelector(".card__image"),this._likeButton=this._newCard.querySelector(".card__like-button"),this._deleteButton=this._newCard.querySelector(".card__trash"),this._likesCounter=this._newCard.querySelector(".card__likes-counter"),this._ownerId!==this._userId&&this._deleteButton.remove(),this._likesCounter.textContent=this._likes.length,this._cardImage.alt=this._name,this._cardImage.src=this._link,this._cardTitle=this._newCard.querySelector(".card__title"),this._cardTitle.textContent=this._name,this._likes.some((e=>e._id===this._userId))&&(this._likeButton.classList.add("card__like-button_active"),this._isLike=!0),this._setEventListeners(),this._newCard}}class t{constructor(e){this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=Array.from(this._popup.querySelectorAll(".form__input")),this._button=this._form.querySelector(".form__save-button")}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>this._formValues[e.name]=e.value)),this._formValues}setButtonText(e){this._button.textContent=e}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){super.close(),this._form.reset()}}class n{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError=(e,t,s)=>{const n=this._formElement.querySelector(`.${t.id}-error`);t.classList.add(this._config.inputErrorClass),n.textContent=t.validationMessage,n.classList.add(this._config.errorClass)};_hideInputError=e=>{const t=this._formElement.querySelector(`.${e.id}-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""};_isValid(e,t,s){t.validity.valid?this._hideInputError(t):this._showInputError(e,t,s)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._config.inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._config.inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners(e,t){this._toggleButtonState(),this._inputList.forEach((s=>{s.addEventListener("input",(()=>{this._isValid(e,s,t),this._toggleButtonState()}))}))}resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._setEventListeners()}}const r={formSelector:".popup__form",inputSelector:".form__input",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},i=document.querySelector(".profile__edit-button"),o=document.querySelector(".popup_type_edit").querySelector(".form"),a=document.querySelector(".popup_type_change-avatar").querySelector("form"),c=document.querySelector(".elements"),l=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_add"),_=h.querySelector(".form"),d=(document.querySelector(".popup_type_image"),document.querySelector(".profile__edit-button-avatar")),u=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>this._checkResponse(e)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>this._checkResponse(e)))}setUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.info})}).then((e=>this._checkResponse(e)))}addNewCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then((e=>this._checkResponse(e)))}putLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then((e=>this._checkResponse(e)))}deleteLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}changeAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>this._checkResponse(e)))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-60",headers:{authorization:"21e5d188-24e1-4766-80db-4d144adb17d5","Content-Type":"application/json"}});let p;const m=new class{constructor({profileNameSelector:e,profileInfoSelector:t,profileAvatarSelector:s}){this._name=document.querySelector(e),this._info=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._name.textContent,info:this._info.textContent,avatar:this._avatar.src}}setUserInfo(e){this._name.textContent=e.name,this._info.textContent=e.about,this._avatar.src=e.avatar}}({profileNameSelector:".profile__name",profileInfoSelector:".profile__description",profileAvatarSelector:".profile__avatar"});Promise.all([u.getUserInfo(),u.getInitialCards()]).then((([e,t])=>{m.setUserInfo(e),p=e._id,f.renderItems(t)})).catch((e=>{console.log(e)}));const f=new class{constructor({renderer:e},t){this._renderer=e,this._container=t}addItem(e){this._container.prepend(e)}renderItems(e){e.reverse().forEach((e=>{this._renderer(e)}))}}({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{const t=v(e);f.addItem(t)}},c);function v(t){return new e(t,"#card-template",C,y,k,p).generateCard()}function k(e,t){e.isLike?u.deleteLike(t).then((t=>{e.setLikes(t.likes)})).catch((e=>console.log(e))):u.putLike(t).then((t=>{e.setLikes(t.likes)})).catch((e=>console.log(e)))}const g=new class extends t{constructor(e,t){super(e),this._form=this._popup.querySelector(".popup__form"),this._button=this._popup.querySelector(".form__save-button"),this._handleConfirmFormSubmit=t}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleConfirmFormSubmit(this._cardId,this._card),super.close()}))}setButtonText(e){this._button.textContent=e}open(e,t){super.open(),this._cardId=e,this._card=t}}(".popup_type_delete-confirmation",(function(e,t){g.setButtonText("Удаление..."),u.deleteCard(t).then((t=>{e.removeCard(t)})).catch((e=>{console.log(e)})).finally((()=>{g.setButtonText("Да")}))}));function y(e,t){g.open(e,t)}g.setEventListeners();const L=new s(".popup_type_edit",(function(e){L.setButtonText("Сохранение..."),u.setUserInfo(e).then((e=>{m.setUserInfo(e),L.close()})).catch((e=>{console.log(e)})).finally((()=>{L.setButtonText("Сохранить")}))}));L.setEventListeners();const E=new s(".popup_type_add",(function(e){E.setButtonText("Сохранение..."),u.addNewCard(e).then((e=>{f.addItem(v(e)),h.close()})).catch((e=>{console.log(e)})).finally((()=>{E.setButtonText("Создать")}))}));E.setEventListeners();const S=new s(".popup_type_change-avatar",(function(e){S.setButtonText("Сохранение..."),u.changeAvatar(e.link).then((e=>{m.setUserInfo(e),S.close()})).catch((e=>{console.log(e)})).finally((()=>{S.setButtonText("Сохранить")}))}));S.setEventListeners();const b=new class extends t{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._title=this._popup.querySelector(".popup__caption")}open(e,t){super.open(),this._image.src=t,this._image.alt=e,this._title.textContent=e}}(".popup_type_image");function C(e,t){b.open(e,t)}b.setEventListeners();const I=new n(r,_);I.enableValidation();const q=new n(r,o);q.enableValidation();const w=new n(r,a);w.enableValidation(),i.addEventListener("click",(()=>{q.resetValidation(),L.open(),L.setInputValues(m.getUserInfo())})),l.addEventListener("click",(()=>{I.resetValidation(),E.open()})),d.addEventListener("click",(()=>{w.resetValidation(),S.open()}))})();