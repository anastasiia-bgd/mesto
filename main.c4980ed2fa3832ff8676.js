(()=>{"use strict";class e{constructor(e,t,s){this._name=e.name,this._link=e.link,this._templateSelector=t,this._openImagePopup=s}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._deleteButton.addEventListener("click",(()=>{this._deleteCard()})),this._likeButton.addEventListener("click",(()=>{this._toggleLike()})),this._cardImage.addEventListener("click",(()=>{this._openImagePopup(this._name,this._link)}))}_deleteCard(){this._newCard.remove()}_toggleLike(){this._likeButton.classList.toggle("card__like-button_active")}_openPopupImage(){openImagePopup(this._name,this._link)}generateCard(){return this._newCard=this._getTemplate(),this._cardImage=this._newCard.querySelector(".card__image"),this._likeButton=this._newCard.querySelector(".card__like-button"),this._cardTitle=this._newCard.querySelector(".card__title"),this._cardTitle.textContent=this._name,this._deleteButton=this._newCard.querySelector(".card__trash"),this._cardImage.alt=this._name,this._cardImage.src=this._link,this._setEventListeners(),this._newCard}}class t{constructor(e){this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=Array.from(this._popup.querySelectorAll(".form__input"))}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>this._formValues[e.name]=e.value)),this._formValues}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){super.close(),this._form.reset()}}class n{constructor(e,t){this._config=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError=(e,t,s)=>{const n=this._formElement.querySelector(`.${t.id}-error`);t.classList.add(this._config.inputErrorClass),n.textContent=t.validationMessage,n.classList.add(this._config.errorClass)};_hideInputError=e=>{const t=this._formElement.querySelector(`.${e.id}-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""};_isValid(e,t,s){t.validity.valid?this._hideInputError(t):this._showInputError(e,t,s)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._config.inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._config.inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners(e,t){this._toggleButtonState(),this._inputList.forEach((s=>{s.addEventListener("input",(()=>{this._isValid(e,s,t),this._toggleButtonState()}))}))}resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._setEventListeners()}}const r={formSelector:".popup__form",inputSelector:".form__input",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},i=document.querySelector(".profile__edit-button"),o=document.querySelector(".popup_type_edit").querySelector(".form"),a=document.querySelector(".elements"),l=document.querySelector(".profile__add-button"),c=document.querySelector(".popup_type_add").querySelector(".form");function _(t){return new e(t,"#card-template",f).generateCard()}document.querySelector(".popup_type_image");const p=new class{constructor({items:e,renderer:t},s){this._initialCards=e,this._renderer=t,this._container=s}addItem(e){this._container.prepend(e)}renderItems(){this._initialCards.forEach((e=>{this._renderer(e)}))}}({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{const t=_(e);p.addItem(t)}},a);p.renderItems();const u=new s(".popup_type_edit",(function(e){h.setUserInfo(e),u.close()}));u.setEventListeners();const d=new s(".popup_type_add",(function(e){const t=_(e);p.addItem(t),d.close()}));d.setEventListeners();const h=new class{constructor({profileNameSelector:e,profileInfoSelector:t}){this._name=document.querySelector(e),this._info=document.querySelector(t)}getUserInfo(){return{name:this._name.textContent,info:this._info.textContent}}setUserInfo(e){this._name.textContent=e.name,this._info.textContent=e.info}}({profileNameSelector:".profile__name",profileInfoSelector:".profile__description"}),m=new class extends t{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._title=this._popup.querySelector(".popup__caption")}open(e,t){super.open(),this._image.src=t,this._image.alt=e,this._title.textContent=e}}(".popup_type_image");function f(e,t){m.open(e,t)}m.setEventListeners();const g=new n(r,c);g.enableValidation();const v=new n(r,o);v.enableValidation(),i.addEventListener("click",(()=>{v.resetValidation(),u.open(),u.setInputValues(h.getUserInfo())})),l.addEventListener("click",(()=>{g.resetValidation(),d.open()}))})();